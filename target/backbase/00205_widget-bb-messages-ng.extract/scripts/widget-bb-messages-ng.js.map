{"version":3,"sources":["webpack:///webpack/universalModuleDefinition?5ca6********","webpack:///webpack/bootstrap 1dcb9870b042a7feed37?d604********","webpack:///./widget-bb-messages-ng/model.xml","webpack:///external \"vendor-bb-angular\"?a114****","webpack:///external \"lib-bb-model-errors\"?7567","webpack:///./widget-bb-messages-ng/scripts/index.js","webpack:///external \"lib-bb-widget-extension-ng\"","webpack:///external \"model-bb-messages-ng\"","webpack:///external \"lib-bb-widget-ng\"","webpack:///external \"lib-bb-user-data-ng\"","webpack:///external \"lib-bb-event-bus-ng\"","webpack:///external \"lib-bb-intent-ng\"","webpack:///./widget-bb-messages-ng/scripts/controller.js","webpack:///./widget-bb-messages-ng/scripts/constants.js","webpack:///./widget-bb-messages-ng/scripts/draft.controller.js","webpack:///./widget-bb-messages-ng/scripts/conversation.controller.js","webpack:///./widget-bb-messages-ng/scripts/default-hooks.js"],"names":["defaultHooks","hooksKey","run","widget","bus","bbIntents","publish","id","getId","init","module","factory","controller","name","MessagesController","errorMessages","ERROR_AUTH","ERROR_CONNECTION","ERROR_UNEXPECTED","model","userDataService","hooks","$q","$ctrl","onNewItemsLoaded","itemsWrapper","state","currentFolder","items","totalCount","logGlobalError","error","modelError","code","globalError","message","logError","fetchData","loadFn","loading","catch","CONVERSATION_LOAD_FAILED","err","finally","enrichWithSenderField","conversations","sender","map","conversationSender","conversation","otherUserName","Object","assign","loadItems","view","offset","finallyCallback","sliceConfig","from","size","config","pageSize","inbox","loadConversations","archived","loadArchivedConversations","sent","loadSentConversations","currentUser","username","drafts","loadDrafts","promise","bind","then","transformConversations","loadPage","pageNo","currentPage","fetchUnreadMessagesCount","getUnreadMessagesCount","unreadMessagesCount","countWrapper","openFolder","selectedConversations","currentView","folders","ConversationData","countUnreadItems","onItemSelected","push","onItemDeselected","splice","indexOf","decrementUnreadMessagesCount","doRemove","deleteInProgress","selected","removeConversation","containsUnread","status","CONVERSATION_REMOVE","CONVERSATION_DELETE_FAILED","removeSelectedItems","promises","forEach","selectedConversation","all","hideMailbox","showMailbox","bindEvents","subscribe","DRAFT_CREATE","DRAFT_SENT","DRAFT_DISMISS","CONVERSATION_CLOSE","CONVERSATION_OPEN","ERROR","$onInit","getUserData","userData","getTopics","topics","freeze","openItem","showUnreadConversationsCount","getBooleanPreference","getLongPreference","statics","views","INBOX","Views","Error","DRAFT_SAVE","CONVERSATION_SAVE_REPLY","CONVERSATION_SEND_REPLY","Text","Event","IntentsKeys","MESSAGE_CREATE","DraftController","$draftCtrl","afterSent","opened","send","pDraft","draft","createDraft","when","response","sendDraft","sendMessageError","dismiss","open","handle","subjectMaxLength","getStringPreference","ConversationController","Promise","messages","fetchMessages","loadMessages","fetchDrafts","getLatestConversationDraft","markConversationMessagesAsRead","pConversation","markUnreadMessagesAsRead","viewConversation","fetchMessagesPromise","markMessagesAsRead","close","sendReply","conversationId","draftId","saveDraft","saveConversationDraft","undefined","idHolder","senderName","body","deliveredOn","Date","toISOString","filter"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;ACVA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;;ACtCA,0C;;;;;;;ACAA,iD;;;;;;;ACAA,iD;;;;;;;;;;;;;ACMA;;;;AAEA;;;;AAEA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;AACA;;;;AACA;;;;AACA;;KAAYA,Y;;;;;;AAEZ,KAAMC,WAAW,6BAAjB,C,CArBA;;;;;;;;AAuBA,UAASC,GAAT,CAAaC,MAAb,EAAqBC,GAArB,EAA0BC,SAA1B,EAAqC;AACnCD,OAAIE,OAAJ,CAAY,iBAAZ,EAA+B;AAC7BC,SAAIJ,OAAOK,KAAP;AADyB,IAA/B;;AAIAH,aAAUI,IAAV,CAAe,YAAM,CAAE,CAAvB;AACD;;mBAEc,0BACZC,MADY,CACL,uBADK,EACoB,qIADpB,EASZC,OATY,CASJV,QATI,EASM,sCAAYD,YAAZ,CATN,EAWZY,UAXY,CAWD,oBAXC,EAWqB;AAChC;;AAWA;AAZgC,6EAIhCX,QAJgC,EAKhC,IALgC;AAsBhC;AAtBgC;AAQhC;AARgC,sBAXrB,EAsBZW,UAtBY,CAsBD,iBAtBC,EAsBkB,8FAK7B,IAL6B;AAO7B;AAP6B,iBAtBlB,EAgCZA,UAhCY,CAgCD,wBAhCC,EAgCyB,2GAKpC,IALoC;AAMpC;AANoC,wBAhCzB,EA0CZV,GA1CY,CA0CR,qFAIHA,GAJG,CA1CQ,EAgDZW,I;;;;;;;AC/EH,iD;;;;;;;ACAA,iD;;;;;;;ACAA,iD;;;;;;;ACAA,iD;;;;;;;ACAA,iD;;;;;;;ACAA,iD;;;;;;;;;;;;;;;mBCSwBC,kB;;AATxB;;AACA;;;;AAEA,KAAMC,gGACM,gBAAKC,UADX,qEAEc,gBAAKC,gBAFnB,mEAGY,gBAAKC,gBAHjB,kBAAN;;AAMe,UAASJ,kBAAT,CAA4BK,KAA5B,EAAmCC,eAAnC,EAAoDC,KAApD,EAA2DC,EAA3D,EAA+DnB,MAA/D,EAAuEC,GAAvE,EAA4E;AAAA;;AACzF;;;;;;AAMA,OAAMmB,QAAQ,IAAd;;AAEA,OAAMC,mBAAmB,SAAnBA,gBAAmB,CAACC,YAAD,EAAkB;AACzCF,WAAMG,KAAN,CAAYC,aAAZ,CAA0BC,KAA1B,GAAkCH,aAAaG,KAA/C;AACAL,WAAMG,KAAN,CAAYC,aAAZ,CAA0BE,UAA1B,GAAuCJ,aAAaI,UAApD;AACD,IAHD;;AAKA;;;;;;;AAOA,OAAMC,iBAAiB,SAAjBA,cAAiB,aAAc;AACnC,SAAIC,QAAQ,EAAZ;AACA,SAAIC,cAAcA,WAAWC,IAA7B,EAAmC;AACjCF,eAAQhB,cAAciB,WAAWC,IAAzB,CAAR;AACD;;AAEDV,WAAMG,KAAN,CAAYQ,WAAZ,GAA0B;AACxBC,gBAASJ;AADe,MAA1B;AAGD,IATD;;AAWA;;;;;;;AAOA,OAAMK,WAAW,SAAXA,QAAW,QAAS;AACxBb,WAAMG,KAAN,CAAYK,KAAZ,GAAoBA,KAApB;AACD,IAFD;;AAIA,OAAMM,YAAY,SAAZA,SAAY,CAACC,MAAD,EAAY;AAC5Bf,WAAMG,KAAN,CAAYC,aAAZ,CAA0BY,OAA1B,GAAoC,IAApC;;AAEA,YAAOD,SACJE,KADI,CACE,eAAO;AAAEpC,WAAIE,OAAJ,CAAY,iBAAMmC,wBAAlB,EAA4CC,GAA5C;AAAmD,MAD9D,EAEJC,OAFI,CAEI,YAAM;AACbpB,aAAMG,KAAN,CAAYC,aAAZ,CAA0BY,OAA1B,GAAoC,KAApC;AACA;AACD,MALI,CAAP;AAMD,IATD;;AAWA;;;;;;;;;;AAUA,OAAMK,wBAAwB,SAAxBA,qBAAwB,CAACC,aAAD,EAAgBC,MAAhB;AAAA,YAC5BD,cAAcE,GAAd,CAAkB,wBAAgB;AAChC,WAAMC,qBAAqBF,UAAUG,aAAaC,aAAlD;AACA,WAAIF,kBAAJ,EAAwB;AACtB,gBAAOG,OAAOC,MAAP,CAAc;AACnBN,mBAAQE;AADW,UAAd,EAEJC,YAFI,CAAP;AAGD;AACD,cAAOA,YAAP;AACD,MARD,CAD4B;AAAA,IAA9B;;AAWA;;;;;;;;;;;;;AAaA,OAAMI,YAAY,SAAZA,SAAY,CAACC,IAAD,EAAOC,MAAP,EAAeC,eAAf,EAAmC;AACnD,SAAMC,cAAc;AAClBC,aAAMH,MADY;AAElBI,aAAMpC,MAAMqC,MAAN,CAAaC;AAFD,MAApB;;AAKA,SAAIvB,eAAJ;AACA,SAAIQ,eAAJ;AACA,aAAQQ,IAAR;AACE,YAAK,iBAAMQ,KAAX;AACExB,kBAASnB,MAAM4C,iBAAf;AACA;;AAEF,YAAK,iBAAMC,QAAX;AACE1B,kBAASnB,MAAM8C,yBAAf;AACA;;AAEF,YAAK,iBAAMC,IAAX;AACE5B,kBAASnB,MAAMgD,qBAAf;AACArB,kBAASvB,MAAM6C,WAAN,CAAkBC,QAA3B;AACA;;AAEF,YAAK,iBAAMC,MAAX;AACEhC,kBAASnB,MAAMoD,UAAf;AACA;;AAEF;AACE,eAAM,uCAA0BjB,IAA1B,6BAAN;AAnBJ;;AAsBA,SAAMkB,UAAUnC,UAAUC,OAAOmC,IAAP,CAAYtD,KAAZ,EAAmBsC,WAAnB,CAAV,EACbiB,IADa,CACR,wBAAgB;AACpB,WAAM9C,QAAQgB,sBACZnB,aAAaoB,aAAb,IAA8BpB,aAAa6C,MAA3C,IAAqD,EADzC,EAEZxB,MAFY,CAAd;;AAIA,cAAO;AACLlB,qBADK;AAELC,qBAAYJ,aAAaI;AAFpB,QAAP;AAID,MAVa,EAWb6C,IAXa,CAWR;AAAA,cACJrD,MAAMsD,sBAAN,CAA6BlD,YAA7B,EAA2CF,MAAMG,KAAN,CAAYC,aAAZ,CAA0BC,KAArE,CADI;AAAA,MAXQ,EAab8C,IAba,CAaRlD,iBAAiBiD,IAAjB,OAbQ,CAAhB;;AAeA,SAAIjB,eAAJ,EAAqB;AACnBgB,eAAQ7B,OAAR,CAAgBa,eAAhB;AACD;;AAED,YAAOgB,OAAP;AACD,IAlDD;;AAoDA;;;;;;;;;;;;AAYA,OAAMI,WAAW,SAAXA,QAAW,CAACtB,IAAD,EAAuC;AAAA,SAAhCuB,MAAgC,uEAAvB,CAAuB;AAAA,SAApBrB,eAAoB;;AACtD,SAAMD,SAAS,CAACsB,SAAS,CAAV,IAAetD,MAAMqC,MAAN,CAAaC,QAA3C;AACA,YAAOR,UAAUC,IAAV,EAAgBC,MAAhB,EAAwBC,eAAxB,EACJkB,IADI,CACC,YAAM;AACVnD,aAAMG,KAAN,CAAYC,aAAZ,CAA0BmD,WAA1B,GAAwCD,MAAxC;AACD,MAHI,CAAP;AAID,IAND;;AAQA;;;;;;;AAOA,OAAME,2BAA2B,SAA3BA,wBAA2B;AAAA,YAC/B5D,MAAM6D,sBAAN,GACGN,IADH,CACQ,wBAAgB;AACpBnD,aAAMG,KAAN,CAAYuD,mBAAZ,GAAkCC,aAAaD,mBAA/C;AACA,cAAOC,YAAP;AACD,MAJH,CAD+B;AAAA,IAAjC;;AAOA;;;;;;;;AAQA,OAAMC,aAAa,SAAbA,UAAa,CAAC7B,IAAD,EAAU;AAC3B;AACA/B,WAAMG,KAAN,CAAY0D,qBAAZ,GAAoC,EAApC;AACA7D,WAAMG,KAAN,CAAY2D,WAAZ,GAA0B/B,IAA1B;AACA/B,WAAMG,KAAN,CAAYC,aAAZ,GAA4BJ,MAAMG,KAAN,CAAY4D,OAAZ,CAAoBhC,IAApB,CAA5B;;AAEA;AACA,SAAI,CAAC/B,MAAMG,KAAN,CAAYC,aAAZ,CAA0BC,KAA/B,EAAsC;AACpCgD,gBAAStB,IAAT;AACD;AACF,IAVD;;AAYA;;;;;;;;;AASA,YAASiC,gBAAT,GAA4B;AAC1B,YAAO;AACL3D,cAAO,IADF,EACQ;AACbC,mBAAY,CAFP;AAGLiD,oBAAa,CAHR;AAILvC,gBAAS;AAJJ,MAAP;AAMD;;AAED;;;;;;;;;AASA,OAAMiD,mBAAmB,SAAnBA,gBAAmB;AAAA,YAAMjE,MAAMG,KAAN,CAAYuD,mBAAlB;AAAA,IAAzB;;AAEA;;;;;;AAMA,YAASQ,cAAT,CAAwBxC,YAAxB,EAAsC;AACpC1B,WAAMG,KAAN,CAAY0D,qBAAZ,CAAkCM,IAAlC,CAAuCzC,YAAvC;AACD;;AAED;;;;;;AAMA,YAAS0C,gBAAT,CAA0B1C,YAA1B,EAAwC;AACtC1B,WAAMG,KAAN,CAAY0D,qBAAZ,CAAkCQ,MAAlC,CACErE,MAAMG,KAAN,CAAY0D,qBAAZ,CAAkCS,OAAlC,CAA0C5C,YAA1C,CADF,EAC2D,CAD3D;AAED;;AAED;;;;;;AAMA,OAAM6C,+BAA+B,SAA/BA,4BAA+B,GAAM;AACzC,SAAIvE,MAAMG,KAAN,CAAYuD,mBAAZ,GAAkC,CAAtC,EAAyC;AACvC1D,aAAMG,KAAN,CAAYuD,mBAAZ;AACD;AACF,IAJD;;AAMA;;;;;;;AAOA,OAAMc,WAAW,SAAXA,QAAW,CAAC9C,YAAD,EAAkB;AACjC,SAAMtB,gBAAgBJ,MAAMG,KAAN,CAAYC,aAAlC;AACA,SAAMkB,gBAAgBlB,cAAcC,KAApC;AACAD,mBAAcE,UAAd;AACAsB,YAAOC,MAAP,CAAcH,YAAd,EAA4B;AAC1B+C,yBAAkB,IADQ;AAE1BC,iBAAU;AAFgB,MAA5B;;AAKA,YAAO9E,MAAM+E,kBAAN,CAAyBjD,aAAa1C,EAAtC,EACJmE,IADI,CACC,YAAM;AACV7B,qBAAc+C,MAAd,CAAqB/C,cAAcgD,OAAd,CAAsB5C,YAAtB,CAArB,EAA0D,CAA1D;AACA,WAAIA,aAAakD,cAAb,IAA+BlD,aAAamD,MAAb,KAAwB,OAA3D,EAAoE;AAClEN;AACD;AACF,MANI,EAOJtD,KAPI,CAOE,UAACE,GAAD,EAAS;AACdN,gBAAS,iBAAMiE,mBAAf;AACA1E,qBAAcE,UAAd;AACAsB,cAAOC,MAAP,CAAcH,YAAd,EAA4B,EAAE+C,kBAAkB,KAApB,EAA5B;;AAEA;;;;;;;AAOA5F,WAAIE,OAAJ,CAAY,iBAAMgG,0BAAlB,EAA8C5D,GAA9C;AACD,MApBI,CAAP;AAqBD,IA9BD;;AAgCA;;;;;;;;AAQA,YAAS6D,mBAAT,GAA+B;AAC7B,SAAMC,WAAW,EAAjB;;AAEAjF,WAAMG,KAAN,CAAY0D,qBAAZ,CAAkCqB,OAAlC,CAA0C,UAACC,oBAAD,EAA0B;AAClEF,gBAASd,IAAT,CAAcK,SAASW,oBAAT,CAAd;AACA;AACD,MAHD;AAIAnF,WAAMG,KAAN,CAAY0D,qBAAZ,GAAoC,EAApC;;AAEA,YAAO9D,GAAGqF,GAAH,CAAOH,QAAP,CAAP;AACD;;AAED;;;;;;AAMA,YAASI,WAAT,GAAuB;AACrBrF,WAAMG,KAAN,CAAYmF,WAAZ,GAA0B,KAA1B;AACD;;AAED;;;;;;AAMA,YAASA,WAAT,GAAuB;AACrBtF,WAAMG,KAAN,CAAYmF,WAAZ,GAA0B,IAA1B;AACD;;AAED;;;;;;;AAOA,YAASC,UAAT,GAAsB;AACpB1G,SAAI2G,SAAJ,CAAc,iBAAMC,YAApB,EAAkCJ,WAAlC;AACAxG,SAAI2G,SAAJ,CAAc,iBAAME,UAApB,EAAgCJ,WAAhC;AACAzG,SAAI2G,SAAJ,CAAc,iBAAMG,aAApB,EAAmCL,WAAnC;AACAzG,SAAI2G,SAAJ,CAAc,iBAAMI,kBAApB,EAAwCN,WAAxC;AACAzG,SAAI2G,SAAJ,CAAc,iBAAMK,iBAApB,EAAuCR,WAAvC;AACAxG,SAAI2G,SAAJ,CAAc,iBAAMtE,wBAApB,EAA8CX,cAA9C;;AAEA;AACA1B,SAAI2G,SAAJ,CAAc,iBAAMM,KAApB,EAA2BjF,QAA3B;AACD;;AAED;;;;AAIA,OAAMkF,UAAU,SAAVA,OAAU,GAAM;AACpBR;AACA1F,qBAAgBmG,WAAhB,GACG7C,IADH,CACQ,oBAAY;AAChBnD,aAAM6C,WAAN,GAAoBoD,QAApB;AACA,cAAOrG,MAAMsG,SAAN,EAAP;AACD,MAJH,EAKG/C,IALH,CAKQ,kBAAU;AACdnD,aAAMmG,MAAN,GAAevE,OAAOwE,MAAP,CAAcD,MAAd,CAAf;AACD,MAPH;;AASAtG,qBAAgBmG,WAAhB,GAA8B7C,IAA9B,CAAmC,oBAAY;AAC7CnD,aAAMiG,QAAN,GAAiBA,QAAjB;AACD,MAFD;AAGD,IAdD;;AAgBA;;;;;;;;AAQA,YAASI,QAAT,CAAkB3E,YAAlB,EAAgC;AAC9B,SAAIA,aAAakD,cAAb,IAA+BlD,aAAamD,MAAb,KAAwB,OAA3D,EAAoE;AAClEN;AACD;AACD;;;;;;AAMA1F,SAAIE,OAAJ,CAAY,iBAAM8G,iBAAlB,EAAqCnE,YAArC;AACD;;AAEDE,UAAOC,MAAP,CAAc7B,KAAd,EAAqB;;AAEnB;;;;;;;;AAQAqC,aAAQT,OAAOwE,MAAP,CAAc;AACpBE,qCAA8B1H,OAAO2H,oBAAP,CAA4B,8BAA5B,CADV;AAEpBjE,iBAAU1D,OAAO4H,iBAAP,CAAyB,UAAzB;AAFU,MAAd,CAVW;;AAenB;;;;;AAKAC,cAAS;AACPC;AADO,MApBU;;AAwBnB;;;;;AAKAvG,YAAO;AACLmF,oBAAa,IADR;AAELxB,oBAAa,iBAAM6C,KAFd;AAGLvG,sBAAe,IAAI4D,gBAAJ,EAHV;AAILD,gBAAS;AACPxB,gBAAO,IAAIyB,gBAAJ,EADA;AAEPrB,eAAM,IAAIqB,gBAAJ,EAFC;AAGPvB,mBAAU,IAAIuB,gBAAJ,EAHH;AAIPjB,iBAAQ,IAAIiB,gBAAJ;AAJD,QAJJ;AAULH,8BAAuB,EAVlB;AAWLrD,cAAO;AAXF,MA7BY;;AA2CnBoD,2BA3CmB;AA4CnB9B,yBA5CmB;AA6CnBuB,uBA7CmB;AA8CnBG,uDA9CmB;AA+CnBS,uCA/CmB;AAgDnBC,mCAhDmB;AAiDnBE,uCAjDmB;AAkDnBiC,uBAlDmB;AAmDnBrB,6CAnDmB;;AAqDnB;AACAe;AAtDmB,IAArB;AAwDD;;AAED;;;;;;AAMA;;;;;;;;;;;;;;AAcA;;;;;;;;;;;;;;;AAeA;;;;;;;;;;;;;;;ACjfA;;;;;AAKO,KAAMa,wBAAQ;AACnBrE,UAAO,OADY;AAEnBI,SAAM,MAFa;AAGnBF,aAAU,UAHS;AAInBM,WAAQ;AAJW,EAAd;;AAOA,KAAM8D,wBAAQ;AACnBC,eAAY,kBADO;AAEnBpB,eAAY,kBAFO;AAGnBqB,4BAAyB,+BAHN;AAInBC,4BAAyB,+BAJN;AAKnBlC,wBAAqB;AALF,EAAd;;AAQP;;;;;;;AAOO,KAAMmC,sBAAO;AAClBxH,eAAY,YADM;AAElBC,qBAAkB,kBAFA;AAGlBC,qBAAkB;AAHA,EAAb;;AAMA,KAAMuH,wBAAQ;AACnB;;;;;AAKApB,UAAO,0BANY;;AAQnBL,iBAAc,iCARK;AASnBC,eAAY,+BATO;AAUnBC,kBAAe,kCAVI;;AAYnBE,sBAAmB,sCAZA;AAanBD,uBAAoB,uCAbD;AAcnBb,+BAA4B,kCAdT;AAenB7D,6BAA0B;AAfP,EAAd;;AAkBP;;;;;;;AAOO,KAAMiG,oCAAc;AACzBC,mBAAgB;AADS,EAApB;;AAIP;;;;;;;;;;;;;;;mBC5DwBC,e;;AAFxB;;AAEe,UAASA,eAAT,CAAyBzH,KAAzB,EAAgChB,MAAhC,EAAwCC,GAAxC,EAA6CkB,EAA7C,EAAiDjB,SAAjD,EAA4D;AACzE;;;;;;AAMA,OAAMwI,aAAa,IAAnB;;AAEA;;;;;;;;AAQA,OAAMC,YAAY,SAAZA,SAAY,GAAM;AACtB;;;;;AAKA1I,SAAIE,OAAJ,CAAY,iBAAM2G,UAAlB;AACA4B,gBAAWnH,KAAX,CAAiBqH,MAAjB,GAA0B,KAA1B;AACD,IARD;;AAUA;;;;;;;;;AASA,OAAMC,OAAO,SAAPA,IAAO,CAACC,MAAD,EAAY;AACvB,SAAMC,QAAQ/F,OAAOC,MAAP,CAAc,EAAd,EAAkB6F,MAAlB,CAAd;AACA,SAAMzE,UAAU,CAAC0E,MAAM3I,EAAP,GAAYY,MAAMgI,WAAN,CAAkBD,KAAlB,CAAZ,GAAuC5H,GAAG8H,IAAH,CAAQF,KAAR,CAAvD;;AAEA,YAAO1E,QACJE,IADI,CACC,oBAAY;AAChBwE,aAAM3I,EAAN,GAAW8I,SAAS9I,EAApB;AACAY,aAAMmI,SAAN,CAAgBJ,MAAM3I,EAAtB,EACGmE,IADH,CACQoE,SADR,EAEGtG,KAFH,CAES,YAAM;AACXpC,aAAIE,OAAJ,CAAY,iBAAM+G,KAAlB,EAAyB,iBAAMgB,UAA/B;AACD,QAJH;AAKD,MARI,EASJ7F,KATI,CASE,YAAM;AACXqG,kBAAWU,gBAAX,GAA8B,IAA9B;AACAnJ,WAAIE,OAAJ,CAAY,iBAAM+G,KAAlB,EAAyB,iBAAMgB,UAA/B;AACA;AACD,MAbI,CAAP;AAcD,IAlBD;;AAoBA;;;;;;AAMA,OAAMmB,UAAU,SAAVA,OAAU,GAAM;AACpB;;;;;AAKApJ,SAAIE,OAAJ,CAAY,iBAAM4G,aAAlB;AACA2B,gBAAWnH,KAAX,CAAiBqH,MAAjB,GAA0B,KAA1B;AACD,IARD;;AAUA;;;;;;AAMA,OAAMU,OAAO,SAAPA,IAAO,GAAM;AACjB;;;;;AAKArJ,SAAIE,OAAJ,CAAY,iBAAM0G,YAAlB;AACA6B,gBAAWnH,KAAX,CAAiBqH,MAAjB,GAA0B,IAA1B;AACD,IARD;;AAUA;;;;AAIA,OAAMzB,UAAU,SAAVA,OAAU,GAAM;AACpBjH,eAAUqJ,MAAV,CAAiB,uBAAYf,cAA7B,EAA6C,YAAM;AACjDc;AACD,MAFD;AAGD,IAJD;;AAMAtG,UAAOC,MAAP,CAAcyF,UAAd,EAA0B;;AAExB;;;;;;;AAOAjF,aAAQT,OAAOwE,MAAP,CAAc;AACpBgC,yBAAkBxJ,OAAOyJ,mBAAP,CAA2B,kBAA3B;AADE,MAAd,CATgB;;AAaxB;;;;;AAKAlI,YAAO;AACLqH,eAAQ;AADH,MAlBiB;;AAsBxBU,eAtBwB;AAuBxBD,qBAvBwB;AAwBxBR,eAxBwB;AAyBxB;AACA1B;AA1BwB,IAA1B;AA4BD;;AAED;;;;;AAKA;;;;AAIA;;;;;;;;;;;;;;;;;;;;mBCzIwBuC,sB;;AAFxB;;AAEe,UAASA,sBAAT,CAAgCzJ,GAAhC,EAAqCe,KAArC,EAA4CC,eAA5C,EAA6D0I,OAA7D,EAAsE;AACnF;;;;;;;AAOA,OAAMvI,QAAQ,IAAd;;AAEA;;;;;AAKA,QAAK0B,YAAL,GAAoB,IAApB;;AAEA;;;;;AAKA,QAAK8G,QAAL,GAAgB,EAAhB;;AAEA;;;;;AAKA,QAAKb,KAAL,GAAa,EAAb;;AAEA,YAASc,aAAT,CAAuB/G,YAAvB,EAAqC;AACnC1B,WAAMwI,QAAN,GAAiB,EAAjB;AACA,YAAO5I,MAAM8I,YAAN,CAAmBhH,aAAa1C,EAAhC,EACJmE,IADI,CACC,UAACqF,QAAD,EAAc;AAClBxI,aAAMwI,QAAN,GAAiBA,QAAjB;AACA,cAAOA,QAAP;AACD,MAJI,CAAP;AAKD;;AAED,YAASG,WAAT,CAAqBjH,YAArB,EAAmC;AACjC1B,WAAM2H,KAAN,GAAc,EAAd;AACA,YAAO/H,MACJgJ,0BADI,CACuBlH,aAAa1C,EADpC,EAEJmE,IAFI,CAEC,UAACwE,KAAD,EAAW;AACf3H,aAAM2H,KAAN,GAAcA,KAAd;AACA;AACD,MALI,CAAP;AAMD;;AAED,YAASkB,8BAAT,CAAwCC,aAAxC,EAAuDN,QAAvD,EAAiE;AAC/D,SAAM9G,eAAeoH,aAArB;AACA,YAAOlJ,MACJmJ,wBADI,CACqBrH,YADrB,EACmC8G,QADnC,EAEJrF,IAFI,CAEC,YAAM;AACVzB,oBAAakD,cAAb,GAA8B,KAA9B;AACD,MAJI,CAAP;AAKD;;AAED;;;;;;;;AAQA,YAASoE,gBAAT,CAA0BtH,YAA1B,EAAwC;AACtC1B,WAAM0B,YAAN,GAAqBA,YAArB;AACA1B,WAAMG,KAAN,CAAY+H,IAAZ,GAAmB,IAAnB;;AAEA,SAAMe,uBAAuBR,cAAc/G,YAAd,CAA7B;AACA,SAAMwH,qBAAqBD,qBACxB9F,IADwB,CACnB;AAAA,cAAY0F,+BAA+BnH,YAA/B,EAA6C8G,QAA7C,CAAZ;AAAA,MADmB,CAA3B;;AAGA,YAAOD,QAAQnD,GAAR,CAAY,CAAC8D,kBAAD,EAAqBP,YAAYjH,YAAZ,CAArB,CAAZ,CAAP;AACD;;AAED;;;;;;AAMA,YAASyH,KAAT,GAAiB;AACfnJ,WAAMG,KAAN,CAAY+H,IAAZ,GAAmB,KAAnB;AACAlI,WAAM0B,YAAN,GAAqB,IAArB;AACA1B,WAAMwI,QAAN,GAAiB,EAAjB;;AAEA;;;;;AAKA3J,SAAIE,OAAJ,CAAY,iBAAM6G,kBAAlB;AACD;;AAED,YAASG,OAAT,GAAmB;AACjBlH,SAAI2G,SAAJ,CAAc,iBAAMK,iBAApB,EAAuCmD,gBAAvC;;AAEAnJ,qBAAgBmG,WAAhB,GAA8B7C,IAA9B,CAAmC,oBAAY;AAC7CnD,aAAM6C,WAAN,GAAoBoD,QAApB;AACD,MAFD;AAGD;;AAED;;;;;;;;;;AAUA,YAASmD,SAAT,CAAmBC,cAAnB,EAAmC1B,KAAnC,EAA0C;AACxC,SAAI2B,UAAU3B,MAAM3I,EAApB;AACA,SAAMuK,YAAY3J,MAAM4J,qBAAN,CAA4BH,cAA5B,EAA4C1B,KAA5C,CAAlB;;AAEA,SAAI2B,YAAYG,SAAhB,EAA2B;AACzBF,iBAAUpG,IAAV,CAAe,oBAAY;AACzBmG,mBAAUI,SAAS1K,EAAnB;AACA;AACD,QAHD;AAID;;AAED,YAAOuK,UACJpG,IADI,CACC,YAAM;AACVnD,aAAMwI,QAAN,CAAerE,IAAf,CAAoB;AAClBnF,aAAIsK,OADc;AAElBK,qBAAY3J,MAAM6C,WAAN,CAAkBC,QAFZ;AAGlB8G,eAAMjC,MAAMiC,IAHM;AAIlBC,sBAAa,IAAIC,IAAJ,GAAWC,WAAX;AAJK,QAApB;;AAOA/J,aAAM2H,KAAN,GAAc,EAAd;AACA;AACD,MAXI,EAYJxE,IAZI,CAYC,YAAM;AACVvD,aACGmI,SADH,CACauB,OADb,EACsB3B,MAAMiC,IAD5B,EAEG3I,KAFH,CAES,YAAM;AACXjB,eAAMwI,QAAN,GAAiBxI,MAAMwI,QAAN,CAAewB,MAAf,CAAsB;AAAA,kBAAWpJ,QAAQ5B,EAAR,KAAesK,OAA1B;AAAA,UAAtB,CAAjB;AACAzK,aAAIE,OAAJ,CAAY,iBAAM+G,KAAlB,EAAyB,iBAAMkB,uBAA/B;AACD,QALH;AAMD,MAnBI,EAoBJ/F,KApBI,CAoBE,YAAM;AACXpC,WAAIE,OAAJ,CAAY,iBAAM+G,KAAlB,EAAyB,iBAAMiB,uBAA/B;AACD,MAtBI,CAAP;AAuBD;;AAEDnF,UAAOC,MAAP,CAAc7B,KAAd,EAAqB;AACnBgJ,uCADmB;AAEnBG,iBAFmB;AAGnBC,yBAHmB;;AAKnB;;;;;AAKAjJ,YAAO;AACL+H,aAAM;AADD,MAVY;;AAcnBnC;AAdmB,IAArB;AAgBD;;AAED;;;;;AAKA;;;;;;;;;;;;;;;;;;;;;;;SCxJgB3C,sB,GAAAA,sB;AAxBhB;;;;;;;;AAQA;;;;;;;;;;;;;;;;AAgBO,UAASA,sBAAT,CAAgClD,YAAhC,EAA8C;AACnD,UAAOA,YAAP;AACD;;mBAEckD,sB","file":"widget-bb-messages-ng/scripts/widget-bb-messages-ng.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"vendor-bb-angular\"), require(\"lib-bb-model-errors\"), require(\"lib-bb-widget-extension-ng\"), require(\"model-bb-messages-ng\"), require(\"lib-bb-widget-ng\"), require(\"lib-bb-user-data-ng\"), require(\"lib-bb-event-bus-ng\"), require(\"lib-bb-intent-ng\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"widget-bb-messages-ng\", [\"vendor-bb-angular\", \"lib-bb-model-errors\", \"lib-bb-widget-extension-ng\", \"model-bb-messages-ng\", \"lib-bb-widget-ng\", \"lib-bb-user-data-ng\", \"lib-bb-event-bus-ng\", \"lib-bb-intent-ng\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"widget-bb-messages-ng\"] = factory(require(\"vendor-bb-angular\"), require(\"lib-bb-model-errors\"), require(\"lib-bb-widget-extension-ng\"), require(\"model-bb-messages-ng\"), require(\"lib-bb-widget-ng\"), require(\"lib-bb-user-data-ng\"), require(\"lib-bb-event-bus-ng\"), require(\"lib-bb-intent-ng\"));\n\telse\n\t\troot[\"widget-bb-messages-ng\"] = factory(root[\"vendor-bb-angular\"], root[\"lib-bb-model-errors\"], root[\"lib-bb-widget-extension-ng\"], root[\"model-bb-messages-ng\"], root[\"lib-bb-widget-ng\"], root[\"lib-bb-user-data-ng\"], root[\"lib-bb-event-bus-ng\"], root[\"lib-bb-intent-ng\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_28__, __WEBPACK_EXTERNAL_MODULE_31__, __WEBPACK_EXTERNAL_MODULE_55__, __WEBPACK_EXTERNAL_MODULE_56__, __WEBPACK_EXTERNAL_MODULE_57__, __WEBPACK_EXTERNAL_MODULE_58__, __WEBPACK_EXTERNAL_MODULE_59__, __WEBPACK_EXTERNAL_MODULE_60__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 1dcb9870b042a7feed37","module.exports = require(\"./scripts/index.js\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./widget-bb-messages-ng/model.xml\n// module id = 0\n// module chunks = 9","module.exports = __WEBPACK_EXTERNAL_MODULE_28__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"vendor-bb-angular\"\n// module id = 28\n// module chunks = 4 5 6 7 8 9","module.exports = __WEBPACK_EXTERNAL_MODULE_31__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lib-bb-model-errors\"\n// module id = 31\n// module chunks = 4 9","/**\n * @module widget-bb-messages-ng\n *\n * @description\n * Message Center Widget\n */\nimport angular from 'vendor-bb-angular';\n\nimport extendHooks from 'lib-bb-widget-extension-ng';\n\nimport modelMessagesModuleKey, { modelMessagesKey } from 'model-bb-messages-ng';\nimport widgetModuleKey, { widgetKey } from 'lib-bb-widget-ng';\nimport bbUserDataModuleKey, { bbUserDataServiceKey } from 'lib-bb-user-data-ng';\nimport eventBusModuleKey, { eventBusKey } from 'lib-bb-event-bus-ng';\nimport intentModuleKey, { bbIntentKey } from 'lib-bb-intent-ng';\n\nimport Controller from './controller';\nimport DraftController from './draft.controller';\nimport ConversationController from './conversation.controller';\nimport * as defaultHooks from './default-hooks';\n\nconst hooksKey = 'widget-bb-messages-ng:hooks';\n\nfunction run(widget, bus, bbIntents) {\n  bus.publish('cxp.item.loaded', {\n    id: widget.getId(),\n  });\n\n  bbIntents.init(() => {});\n}\n\nexport default angular\n  .module('widget-bb-messages-ng', [\n    modelMessagesModuleKey,\n    widgetModuleKey,\n    bbUserDataModuleKey,\n    eventBusModuleKey,\n    intentModuleKey,\n  ])\n\n  .factory(hooksKey, extendHooks(defaultHooks))\n\n  .controller('MessagesController', [\n    // dependencies to inject\n    modelMessagesKey,\n    bbUserDataServiceKey,\n    hooksKey,\n    '$q',\n    widgetKey,\n    eventBusKey,\n    /* into */\n    Controller,\n  ])\n  .controller('DraftController', [\n    // dependencies to inject\n    modelMessagesKey,\n    widgetKey,\n    eventBusKey,\n    '$q',\n    bbIntentKey,\n    /* into */\n    DraftController,\n  ])\n  .controller('ConversationController', [\n    // dependencies to inject\n    eventBusKey,\n    modelMessagesKey,\n    bbUserDataServiceKey,\n    '$q',\n    // into\n    ConversationController,\n  ])\n\n  .run([\n    widgetKey,\n    eventBusKey,\n    bbIntentKey,\n    run,\n  ])\n  .name;\n\n\n\n// WEBPACK FOOTER //\n// ./widget-bb-messages-ng/scripts/index.js","module.exports = __WEBPACK_EXTERNAL_MODULE_55__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lib-bb-widget-extension-ng\"\n// module id = 55\n// module chunks = 9","module.exports = __WEBPACK_EXTERNAL_MODULE_56__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"model-bb-messages-ng\"\n// module id = 56\n// module chunks = 9","module.exports = __WEBPACK_EXTERNAL_MODULE_57__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lib-bb-widget-ng\"\n// module id = 57\n// module chunks = 9","module.exports = __WEBPACK_EXTERNAL_MODULE_58__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lib-bb-user-data-ng\"\n// module id = 58\n// module chunks = 9","module.exports = __WEBPACK_EXTERNAL_MODULE_59__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lib-bb-event-bus-ng\"\n// module id = 59\n// module chunks = 9","module.exports = __WEBPACK_EXTERNAL_MODULE_60__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lib-bb-intent-ng\"\n// module id = 60\n// module chunks = 9","import { E_AUTH, E_CONNECTIVITY, E_UNEXPECTED } from 'lib-bb-model-errors';\nimport { Event, Text, Views, Error } from './constants';\n\nconst errorMessages = {\n  [E_AUTH]: Text.ERROR_AUTH,\n  [E_CONNECTIVITY]: Text.ERROR_CONNECTION,\n  [E_UNEXPECTED]: Text.ERROR_UNEXPECTED,\n};\n\nexport default function MessagesController(model, userDataService, hooks, $q, widget, bus) {\n  /**\n   * @name MessagesController\n   * @ngkey MessagesController\n   * @type {object}\n   * @description Controller for message conversations list.\n   */\n  const $ctrl = this;\n\n  const onNewItemsLoaded = (itemsWrapper) => {\n    $ctrl.state.currentFolder.items = itemsWrapper.items;\n    $ctrl.state.currentFolder.totalCount = itemsWrapper.totalCount;\n  };\n\n  /**\n   * @name MessagesController#logGlobalError\n   * @description Registers global error.\n   * This blocks from using the widget.\n   * @param {object} modelError Error retuned from Data module\n   * @type {function}\n   */\n  const logGlobalError = modelError => {\n    let error = '';\n    if (modelError && modelError.code) {\n      error = errorMessages[modelError.code];\n    }\n\n    $ctrl.state.globalError = {\n      message: error,\n    };\n  };\n\n  /**\n   * @name MessagesController#logError\n   * @description Registers error.\n   * This does not block the user form using other parts of the widget.\n   * @param {string} error Error code\n   * @type {function}\n   */\n  const logError = error => {\n    $ctrl.state.error = error;\n  };\n\n  const fetchData = (loadFn) => {\n    $ctrl.state.currentFolder.loading = true;\n\n    return loadFn()\n      .catch(err => { bus.publish(Event.CONVERSATION_LOAD_FAILED, err); })\n      .finally(() => {\n        $ctrl.state.currentFolder.loading = false;\n        return;\n      });\n  };\n\n  /**\n   * @description Enriches conversations with sender field.\n   * If the sender parameter is undefined, conversation.otherUserName is mapped\n   * to the sender field.\n   *\n   * @param {Array<Conversation>} conversations array of conversations\n   * @param {string?} sender sender's name to be mapped to conversations.\n   * If not specified, conversation.otherUserName is used.\n   * @type {function}\n   * */\n  const enrichWithSenderField = (conversations, sender) =>\n    conversations.map(conversation => {\n      const conversationSender = sender || conversation.otherUserName;\n      if (conversationSender) {\n        return Object.assign({\n          sender: conversationSender,\n        }, conversation);\n      }\n      return conversation;\n    });\n\n  /**\n   * @description\n   * Loads items for given view. The number of returned items is always equal or lower than limit.\n   * This method can both be used with \"ui-bb-load-more-ng\" component.\n   * @name MessagesController#loadPage\n   * @param {string} view view for which the page should be loaded\n   * @param {number} [offset] offset, from which the items will be collected.\n   * @param {number} [limit] limit, which determines the maximum amount of returned items.\n   * @param {function} [finallyCallback] optional callback function to be executed after page is\n   *                                   loaded. It will be executed both on successful and failing\n   *                                   loads.\n   * @type {function}\n   */\n  const loadItems = (view, offset, finallyCallback) => {\n    const sliceConfig = {\n      from: offset,\n      size: $ctrl.config.pageSize,\n    };\n\n    let loadFn;\n    let sender;\n    switch (view) {\n      case Views.inbox:\n        loadFn = model.loadConversations;\n        break;\n\n      case Views.archived:\n        loadFn = model.loadArchivedConversations;\n        break;\n\n      case Views.sent:\n        loadFn = model.loadSentConversations;\n        sender = $ctrl.currentUser.username;\n        break;\n\n      case Views.drafts:\n        loadFn = model.loadDrafts;\n        break;\n\n      default:\n        throw new Error(`Unknown view ${view}. Unable to fetch data.`);\n    }\n\n    const promise = fetchData(loadFn.bind(model, sliceConfig))\n      .then(itemsWrapper => {\n        const items = enrichWithSenderField(\n          itemsWrapper.conversations || itemsWrapper.drafts || [],\n          sender);\n\n        return {\n          items,\n          totalCount: itemsWrapper.totalCount,\n        };\n      })\n      .then(itemsWrapper =>\n        hooks.transformConversations(itemsWrapper, $ctrl.state.currentFolder.items))\n      .then(onNewItemsLoaded.bind(this));\n\n    if (finallyCallback) {\n      promise.finally(finallyCallback);\n    }\n\n    return promise;\n  };\n\n  /**\n   * @description\n   * Loads a page of items for given view. Pages are counted starting with 1.\n   * This method can both be used with \"ui-bb-load-more-ng\" and \"uib-pagination\" components.\n   * @name MessagesController#loadPage\n   * @param {string} view view for which the page should be loaded\n   * @param {number} [pageNo=1] Optional page number to load. Numbering starts to 1. Defaults to 1.\n   * @param {function} [finallyCallback] optional callback function to be executed after page is\n   *                                   loaded. It will be executed both on successful and failing\n   *                                   loads.\n   * @type {function}\n   */\n  const loadPage = (view, pageNo = 1, finallyCallback) => {\n    const offset = (pageNo - 1) * $ctrl.config.pageSize;\n    return loadItems(view, offset, finallyCallback)\n      .then(() => {\n        $ctrl.state.currentFolder.currentPage = pageNo;\n      });\n  };\n\n  /**\n   * @name MessagesController#fetchUnreadMessagesCount\n   * @description Counts user's unread messages and updates the model value\n   * @type {function}\n   * @returns {Promise.<{unreadMessagesCount: number}>}\n   *          a promise holding user's unread messages count\n   */\n  const fetchUnreadMessagesCount = () =>\n    model.getUnreadMessagesCount()\n      .then(countWrapper => {\n        $ctrl.state.unreadMessagesCount = countWrapper.unreadMessagesCount;\n        return countWrapper;\n      });\n\n  /**\n   * @description\n   * Switches mailbox view between different conversation lists.\n   * E.g. from Drafts to Archived.\n   * @name MessagesController#openFolder\n   * @param {string} view View for which folder should be revealed\n   * @type {function}\n   */\n  const openFolder = (view) => {\n    /* Clear selections */\n    $ctrl.state.selectedConversations = [];\n    $ctrl.state.currentView = view;\n    $ctrl.state.currentFolder = $ctrl.state.folders[view];\n\n    /* Load items if not loaded */\n    if (!$ctrl.state.currentFolder.items) {\n      loadPage(view);\n    }\n  };\n\n  /**\n   * @typedef {Object} ConversationData\n   * @property {Array<Conversation>} items List of conversations. Null value means that\n   *                                       conversations haven't been loaded yet.\n   * @property {number} totalCount total count of items in the backend. Used to determine if there\n   *                               are more pages to load.\n   * @property {number} currentPage current page. Numbering starts at 1.\n   * @property {boolean} loading Flag indicating whether conversation data is currently being loaded\n   */\n  function ConversationData() {\n    return {\n      items: null, // null means not loaded\n      totalCount: 0,\n      currentPage: 1,\n      loading: false,\n    };\n  }\n\n  /**\n   * @name MessagesController#countUnreadItems\n   * @description\n   * Returns unread item count for user Inbox.\n   * Returns 0, if inbox is loading.\n   *\n   * @type {function}\n   * @returns {number}\n   */\n  const countUnreadItems = () => $ctrl.state.unreadMessagesCount;\n\n  /**\n   * @description Handles conversation selection\n   * @name MessagesController#onItemSelected\n   * @param {Conversation} conversation Conversation to be selected\n   * @type {function}\n   */\n  function onItemSelected(conversation) {\n    $ctrl.state.selectedConversations.push(conversation);\n  }\n\n  /**\n   * @description Handles conversation de-selection\n   * @name MessagesController#onItemDeselected\n   * @param {Conversation} conversation Conversation to be de-selected\n   * @type {function}\n   */\n  function onItemDeselected(conversation) {\n    $ctrl.state.selectedConversations.splice(\n      $ctrl.state.selectedConversations.indexOf(conversation), 1);\n  }\n\n  /**\n   * @name MessagesController#decrementUnreadMessagesCount\n   * @description Decrements unread messages count\n   * @type {function}\n   * @inner\n   */\n  const decrementUnreadMessagesCount = () => {\n    if ($ctrl.state.unreadMessagesCount > 0) {\n      $ctrl.state.unreadMessagesCount--;\n    }\n  };\n\n  /**\n   * @description Removes given conversation\n   * @name MessagesController#doRemove\n   * @param {Object} conversation Converstation to be removed\n   * @inner\n   * @type {function}\n   */\n  const doRemove = (conversation) => {\n    const currentFolder = $ctrl.state.currentFolder;\n    const conversations = currentFolder.items;\n    currentFolder.totalCount--;\n    Object.assign(conversation, {\n      deleteInProgress: true,\n      selected: false,\n    });\n\n    return model.removeConversation(conversation.id)\n      .then(() => {\n        conversations.splice(conversations.indexOf(conversation), 1);\n        if (conversation.containsUnread && conversation.status === 'inbox') {\n          decrementUnreadMessagesCount();\n        }\n      })\n      .catch((err) => {\n        logError(Error.CONVERSATION_REMOVE);\n        currentFolder.totalCount++;\n        Object.assign(conversation, { deleteInProgress: false });\n\n        /*\n         * Event indicates that removal of a conversation has failed.\n         *\n         * <p> Payload contains server-side error </p>\n         * @event bb.event.messaging.delete.failed\n         * @type {string}\n         */\n        bus.publish(Event.CONVERSATION_DELETE_FAILED, err);\n      });\n  };\n\n  /**\n   * Removes selected conversations.\n   * <p>Selected conversations are tracked in \"selectedConversations\" property in controller's\n   * state object.</p>\n   * @name MessagesController#removeSelectedItems\n   * @type {function}\n   * @return {Promise} succesful promise if removal of all selected conversations succeeded\n   */\n  function removeSelectedItems() {\n    const promises = [];\n\n    $ctrl.state.selectedConversations.forEach((selectedConversation) => {\n      promises.push(doRemove(selectedConversation));\n      return;\n    });\n    $ctrl.state.selectedConversations = [];\n\n    return $q.all(promises);\n  }\n\n  /**\n   * @name MessagesController#hideMailbox\n   * @description Turn mailbox display OFF\n   * @type {function}\n   * @inner\n   */\n  function hideMailbox() {\n    $ctrl.state.showMailbox = false;\n  }\n\n  /**\n   * @name MessagesController#showMailbox\n   * @description Turn mailbox display ON\n   * @type {function}\n   * @inner\n   */\n  function showMailbox() {\n    $ctrl.state.showMailbox = true;\n  }\n\n  /**\n   * @name MessagesController#bindEvents\n   * @description Adds subscriptions to bus events\n   *\n   * @inner\n   * @type {function}\n   */\n  function bindEvents() {\n    bus.subscribe(Event.DRAFT_CREATE, hideMailbox);\n    bus.subscribe(Event.DRAFT_SENT, showMailbox);\n    bus.subscribe(Event.DRAFT_DISMISS, showMailbox);\n    bus.subscribe(Event.CONVERSATION_CLOSE, showMailbox);\n    bus.subscribe(Event.CONVERSATION_OPEN, hideMailbox);\n    bus.subscribe(Event.CONVERSATION_LOAD_FAILED, logGlobalError);\n\n    // Error handling\n    bus.subscribe(Event.ERROR, logError);\n  }\n\n  /*\n   * @description Widget initialization logic.\n   * @type {function}\n   */\n  const $onInit = () => {\n    bindEvents();\n    userDataService.getUserData()\n      .then(userData => {\n        $ctrl.currentUser = userData;\n        return model.getTopics();\n      })\n      .then(topics => {\n        $ctrl.topics = Object.freeze(topics);\n      });\n\n    userDataService.getUserData().then(userData => {\n      $ctrl.userData = userData;\n    });\n  };\n\n  /**\n   * Opens given conversation item. Hides currently viewed mailbox and\n   * publishes event to open conversation.\n   * @name MessagesController#openItem\n   * @type {function}\n   * @param {Conversation} conversation conversation to open\n   * @fires bb.event.messaging.conversation.open\n   */\n  function openItem(conversation) {\n    if (conversation.containsUnread && conversation.status === 'inbox') {\n      decrementUnreadMessagesCount();\n    }\n    /*\n     * Event indicates that user has initiated opening of a single conversation.\n     * <p>Payload is of Conversation type</p>\n     * @event bb.event.messaging.conversation.open\n     * @type {string}\n     */\n    bus.publish(Event.CONVERSATION_OPEN, conversation);\n  }\n\n  Object.assign($ctrl, {\n\n    /**\n     * Config mapped from widget's preferences.\n     *\n     * <p>\"showUnreadConversationsCount\" is mapped from \"showUnreadConversationsCount\" preference\n     * </p>\n     * @name MessagesController#config\n     * @type {MessagesControllerConfig}\n     */\n    config: Object.freeze({\n      showUnreadConversationsCount: widget.getBooleanPreference('showUnreadConversationsCount'),\n      pageSize: widget.getLongPreference('pageSize'),\n    }),\n\n    /**\n     *  Holds static data of controller.\n     *  @name MessagesController#statics\n     *  @type {MessagesControllerStatics}\n     */\n    statics: {\n      views: Views,\n    },\n\n    /**\n     * @description Keeps state related data\n     * @name MessagesController#state\n     * @type {MessagesControllerState}\n     */\n    state: {\n      showMailbox: true,\n      currentView: Views.INBOX,\n      currentFolder: new ConversationData(),\n      folders: {\n        inbox: new ConversationData(),\n        sent: new ConversationData(),\n        archived: new ConversationData(),\n        drafts: new ConversationData(),\n      },\n      selectedConversations: [],\n      error: null,\n    },\n\n    openFolder,\n    loadItems,\n    loadPage,\n    fetchUnreadMessagesCount,\n    countUnreadItems,\n    onItemSelected,\n    onItemDeselected,\n    openItem,\n    removeSelectedItems,\n\n    /* Lifecycle hooks */\n    $onInit,\n  });\n}\n\n/**\n * @typedef {Object} MessagesControllerConfig\n * @property {Number} subjectMaxLength Max allowed length for new draft subject.\n * @property {Number} pageSize Number of items to be displayed in a single page load\n */\n\n/**\n * @typedef {Object} MessagesControllerState State of MessagesController\n * @property {boolean} showMailbox Mailbox show/hide flag\n * @property {string} currentView Tracks the state of which Folder the user has active\n * @property {ConversationData} currentFolder Data of currently opened folder\n * @property {Object<string, ConversationData>} folders Holds users mailbox data. Keys as folders\n * @property {Array<Conversation>} selectedConversations An array of currently selected\n *                                                       conversations\n * @property {string} error Recent error code, if any.\n * @property {string} globalError Global error, if any.\n * @property {number} unreadMessagesCount Unread messages count,\n                                          undefined if the call to backend failed.\n */\n\n/**\n * @typedef {Object} Conversation\n * @property {string} id ID of the conversation\n * @property {string} category category of the conversation\n * @property {string} otherUser other user's LDAP user string\n * @property {string} otherUserName other user's name\n * @property {string} sender name of the conversation sender\n * @property {string} body body of last message in the conversation\n * @property {string} subject conversation subject\n * @property {boolean} containsUnread flag indicating whether the conversation has unread messages\n * @property {boolean} important importance flag\n * @property {number} numberOfMessages count of number of messages in the conversation\n * @property {string} timestamp last modification time\n */\n\n/**\n * @typedef {Object} MessagesControllerStatics\n * @property {Views} views views supported by controller\n */\n\n\n\n// WEBPACK FOOTER //\n// ./widget-bb-messages-ng/scripts/controller.js","/**\n * @description Different views the user can toggle between\n * @name Views\n * @type {Views}\n */\nexport const Views = {\n  inbox: 'inbox',\n  sent: 'sent',\n  archived: 'archived',\n  drafts: 'drafts',\n};\n\nexport const Error = {\n  DRAFT_SAVE: 'error.draft.save',\n  DRAFT_SENT: 'error.draft.send',\n  CONVERSATION_SAVE_REPLY: 'error.conversation.save-reply',\n  CONVERSATION_SEND_REPLY: 'error.conversation.send-reply',\n  CONVERSATION_REMOVE: 'error.conversation.remove',\n};\n\n/**\n * @description\n * Widget static texts for the template\n *\n * @name Text\n * @type {object}\n */\nexport const Text = {\n  ERROR_AUTH: 'error.auth',\n  ERROR_CONNECTION: 'error.connection',\n  ERROR_UNEXPECTED: 'error.unexpected',\n};\n\nexport const Event = {\n  /**\n   * @event bb.event.messaging.error\n   * @description Event payload is a string with error code.\n   * @type {string}\n   */\n  ERROR: 'bb.event.messaging.error',\n\n  DRAFT_CREATE: 'bb.event.messaging.draft.create',\n  DRAFT_SENT: 'bb.event.messaging.draft.sent',\n  DRAFT_DISMISS: 'bb.event.messaging.draft.dismiss',\n\n  CONVERSATION_OPEN: 'bb.event.messaging.conversation.open',\n  CONVERSATION_CLOSE: 'bb.event.messaging.conversation.close',\n  CONVERSATION_DELETE_FAILED: 'bb.event.messaging.delete.failed',\n  CONVERSATION_LOAD_FAILED: 'bb.event.messaging.load.failed',\n};\n\n/**\n * @description\n * Widget intents to be handled\n *\n * @name IntentsKeys\n * @type {object}\n */\nexport const IntentsKeys = {\n  MESSAGE_CREATE: 'go.message.create',\n};\n\n/**\n * Contains dynamic properties with view names. Example: {inbox: \"inbox\"}.\n * @typedef {Object} Views\n */\n\n\n\n// WEBPACK FOOTER //\n// ./widget-bb-messages-ng/scripts/constants.js","import { Event, Error, IntentsKeys } from './constants';\n\nexport default function DraftController(model, widget, bus, $q, bbIntents) {\n  /**\n   * @name DraftController\n   * @ngkey DraftController\n   * @type {object}\n   * @description Draft Controller is responsible for draft creation and sending.\n   */\n  const $draftCtrl = this;\n\n  /**\n   * @description Handles logic after draft has been sent\n   * @name DraftController#afterSent\n   * @param {any} draft Draft letter which was sent\n   * @type {function}\n   * @fires bb.event.messaging.draft.sent\n   * @inner\n   */\n  const afterSent = () => {\n    /**\n     * @event bb.event.messaging.draft.sent\n     * @description Event fired when draft has been sent. Event carries no payload.\n     * @type {string}\n     */\n    bus.publish(Event.DRAFT_SENT);\n    $draftCtrl.state.opened = false;\n  };\n\n  /**\n   * @description Sends out given draft letter\n   * @name DraftController#send\n   * @param {Draft} pDraft Draft letter to send\n   * @fires bb.event.messaging.draft.sent\n   * @fires bb.event.messaging.error\n   * @type {function}\n   * @return {Promise} succesful promise if draft has been sent successfully\n   */\n  const send = (pDraft) => {\n    const draft = Object.assign({}, pDraft);\n    const promise = !draft.id ? model.createDraft(draft) : $q.when(draft);\n\n    return promise\n      .then(response => {\n        draft.id = response.id;\n        model.sendDraft(draft.id)\n          .then(afterSent)\n          .catch(() => {\n            bus.publish(Event.ERROR, Error.DRAFT_SAVE);\n          });\n      })\n      .catch(() => {\n        $draftCtrl.sendMessageError = true;\n        bus.publish(Event.ERROR, Error.DRAFT_SAVE);\n        return;\n      });\n  };\n\n  /**\n   * @description Cancel draft editing\n   * @name DraftController#dismiss\n   * @type {function}\n   * @fires bb.event.messaging.draft.dismiss\n   */\n  const dismiss = () => {\n    /**\n     * @event bb.event.messaging.draft.dismiss\n     * @description Event fired when user dismisses draft creation. Event carries no payload.\n     * @type {string}\n     */\n    bus.publish(Event.DRAFT_DISMISS);\n    $draftCtrl.state.opened = false;\n  };\n\n  /**\n   * @description Initiate draft creation/editing\n   * @name DraftController#open\n   * @type {function}\n   * @fires bb.event.messaging.draft.create\n   */\n  const open = () => {\n    /**\n     * @event bb.event.messaging.draft.create\n     * @description Event fired when user opens draft creation. Event carries no payload.\n     * @type {string}\n     */\n    bus.publish(Event.DRAFT_CREATE);\n    $draftCtrl.state.opened = true;\n  };\n\n  /*\n   * @description Widget initialization logic.\n   * @type {function}\n   */\n  const $onInit = () => {\n    bbIntents.handle(IntentsKeys.MESSAGE_CREATE, () => {\n      open();\n    });\n  };\n\n  Object.assign($draftCtrl, {\n\n    /**\n     * Config mapped from widget's preferences.\n     *\n     * <p>\"subjectMaxLength\" is mapped from \"subjectMaxLength\" preference</p>\n     * @name DraftController#config\n     * @type {DraftControllerConfig}\n     */\n    config: Object.freeze({\n      subjectMaxLength: widget.getStringPreference('subjectMaxLength'),\n    }),\n\n    /**\n     * Holds controller's state\n     * @name DraftController#state\n     * @type {DraftControllerState}\n     */\n    state: {\n      opened: false,\n    },\n\n    open,\n    dismiss,\n    send,\n    /* Lifecycle hooks */\n    $onInit,\n  });\n}\n\n/**\n * @typedef {Object} DraftControllerState\n * @property {boolean} opened indicates whether draft editing is currently opened\n */\n\n/**\n * @typedef {Object} DraftControllerConfig\n * @property {number} subjectMaxLength Max allowed length for new draft subject.\n */\n/**\n * @typedef {Object} Draft\n * @property {string} body\n * @property {string} subject\n * @property {string} recipient LDAP X500Principle representation of recipient\n * @property {string} category category of the draft\n * @property {boolean} important flag indicating importance of the message\n * @property {object} additions API extension additions\n */\n\n\n\n// WEBPACK FOOTER //\n// ./widget-bb-messages-ng/scripts/draft.controller.js","import { Event, Error } from './constants';\n\nexport default function ConversationController(bus, model, userDataService, Promise) {\n  /**\n   * Conversation controller handles logic of viewing and operating a list of\n   * messages in a single conversation.\n   * @name ConversationController\n   * @ngkey ConversationController\n   * @type {Object}\n   */\n  const $ctrl = this;\n\n  /**\n   * The currently opened conversation\n   * @name ConversationController#conversation\n   * @type {Conversation}\n   */\n  this.conversation = null;\n\n  /**\n   * Messages of currently opened conversation.\n   * @name ConversationController#messages\n   * @type {Array<Message>}\n   */\n  this.messages = [];\n\n  /**\n   * Reply draft.\n   * @name ConversationController#draft\n   * @type {Draft}\n   */\n  this.draft = {};\n\n  function fetchMessages(conversation) {\n    $ctrl.messages = [];\n    return model.loadMessages(conversation.id)\n      .then((messages) => {\n        $ctrl.messages = messages;\n        return messages;\n      });\n  }\n\n  function fetchDrafts(conversation) {\n    $ctrl.draft = {};\n    return model\n      .getLatestConversationDraft(conversation.id)\n      .then((draft) => {\n        $ctrl.draft = draft;\n        return;\n      });\n  }\n\n  function markConversationMessagesAsRead(pConversation, messages) {\n    const conversation = pConversation;\n    return model\n      .markUnreadMessagesAsRead(conversation, messages)\n      .then(() => {\n        conversation.containsUnread = false;\n      });\n  }\n\n  /**\n   * Presents messages of the conversation for viewing. Also, marks unread messages of\n   * conversation as read.\n   * @name ConversationController#viewConversation\n   * @type {function}\n   * @param {Conversation} conversation conversation to view\n   * @return {Promise} a succesful promise when all data has been loaded\n   */\n  function viewConversation(conversation) {\n    $ctrl.conversation = conversation;\n    $ctrl.state.open = true;\n\n    const fetchMessagesPromise = fetchMessages(conversation);\n    const markMessagesAsRead = fetchMessagesPromise\n      .then(messages => markConversationMessagesAsRead(conversation, messages));\n\n    return Promise.all([markMessagesAsRead, fetchDrafts(conversation)]);\n  }\n\n  /**\n   * Closes conversation view.\n   * @name ConversationController#close\n   * @type {function}\n   * @fires bb.event.messaging.conversation.close\n   */\n  function close() {\n    $ctrl.state.open = false;\n    $ctrl.conversation = null;\n    $ctrl.messages = [];\n\n    /**\n     * Event is fired when user closes single conversation view. Event carries no payload.\n     * @event bb.event.messaging.conversation.close\n     * @type {string}\n     */\n    bus.publish(Event.CONVERSATION_CLOSE);\n  }\n\n  function $onInit() {\n    bus.subscribe(Event.CONVERSATION_OPEN, viewConversation);\n\n    userDataService.getUserData().then(userData => {\n      $ctrl.currentUser = userData;\n    });\n  }\n\n  /**\n   * Sends out a draft as reply to the given conversation\n   * @name ConversationController#sendReply\n   * @param {string} conversationId ID of the conversation to which the draft should be sent\n   * as a reply\n   * @type {function}\n   * @param {Draft} draft the draft to send\n   * @fires bb.event.messaging.error\n   * @return {Promise} a successful promise of reply draft has been sent successfully\n   */\n  function sendReply(conversationId, draft) {\n    let draftId = draft.id;\n    const saveDraft = model.saveConversationDraft(conversationId, draft);\n\n    if (draftId === undefined) {\n      saveDraft.then(idHolder => {\n        draftId = idHolder.id;\n        return;\n      });\n    }\n\n    return saveDraft\n      .then(() => {\n        $ctrl.messages.push({\n          id: draftId,\n          senderName: $ctrl.currentUser.username,\n          body: draft.body,\n          deliveredOn: new Date().toISOString(),\n        });\n\n        $ctrl.draft = {};\n        return;\n      })\n      .then(() => {\n        model\n          .sendDraft(draftId, draft.body)\n          .catch(() => {\n            $ctrl.messages = $ctrl.messages.filter(message => message.id !== draftId);\n            bus.publish(Event.ERROR, Error.CONVERSATION_SEND_REPLY);\n          });\n      })\n      .catch(() => {\n        bus.publish(Event.ERROR, Error.CONVERSATION_SAVE_REPLY);\n      });\n  }\n\n  Object.assign($ctrl, {\n    viewConversation,\n    close,\n    sendReply,\n\n    /**\n     * Holds state of controller.\n     * @name ConversationController#state\n     * @type {ConversationControllerState}\n     */\n    state: {\n      open: false,\n    },\n\n    $onInit,\n  });\n}\n\n/**\n * @typedef {Object} ConversationControllerState\n * @property {boolean} open flag inidicating whether single conversation view is open\n */\n\n/**\n * @typedef {Object} Message\n * @property {string} id ID of the message\n * @property {string} subject subject of the conversation the message belongs to\n * @property {string} body message body\n * @property {string} category category of the conversation the message belongs to\n * @property {string} status message status (READ, DELIVERED, etc)\n * @property {string} sender message sender's X500Principle string representation\n * @property {string} senderName message sender's name\n * @property {string} deliveredOn message's delivery timestamp\n * @property {boolean} important flag indicating importance of conversation the message belongs to\n */\n\n\n\n// WEBPACK FOOTER //\n// ./widget-bb-messages-ng/scripts/conversation.controller.js","/**\n * @name Hooks\n * @type {object}\n *\n * @description\n * Hooks for widget-bb-messages-ng\n */\n\n/**\n * @description\n * A hook which will be called when a page of items is loaded.\n * This hook can be used to customize how the new page is displayed.\n * For example, if \"Show more\" functionality used for paging,\n * then this hook should just append new items to current items.\n * As another example, if pagination component is used,\n * this hook should just return the new items.\n * @name Hooks#transformConversations\n * @param {itemsWrapper} itemsWrapper a wrapper for newly loaded page items. The object will have\n *                                    the following structures: {items: [], totalCount: 0}\n * @param {object} currentItems list of current items displayed in the folder\n * @returns {object} a wrapper object of items which will be used as items to display in current\n *                   folder. Object structure should be as follow: {items: [], totalCount: 0}\n * @type {function}\n */\nexport function transformConversations(itemsWrapper) {\n  return itemsWrapper;\n}\n\nexport default transformConversations;\n\n\n\n// WEBPACK FOOTER //\n// ./widget-bb-messages-ng/scripts/default-hooks.js"],"sourceRoot":""}